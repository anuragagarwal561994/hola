!function e(o,n,r){function i(s,t){if(!n[s]){if(!o[s]){var l="function"==typeof require&&require;if(!t&&l)return l(s,!0);if(a)return a(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};o[s][0].call(c.exports,function(e){var n=o[s][1][e];return i(n||e)},c,c.exports,e,o,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,o,n){"use strict";var r={apiKey:"AIzaSyDcatmPrGGXCQxRlrs_LHIpyKl3kZiBry0",authDomain:"halo-566cd.firebaseapp.com",databaseURL:"https://halo-566cd.firebaseio.com",projectId:"halo-566cd",storageBucket:"halo-566cd.appspot.com",messagingSenderId:"415046071342"};firebase.apps.length||firebase.initializeApp(r);var i=angular.module("app",["ngRoute","ngMessages"]);i.config(["$httpProvider",function(e){e.defaults.headers.common["X-Requested-With"]="XMLHttpRequest"}]),i.config(["$routeProvider",function(e){e.when("/",{controller:"homeController",templateUrl:"views/home.html"}).when("/dashboard",{controller:"dashboardController",templateUrl:"views/dashboard.html"}).when("/billing",{controller:"billingController",templateUrl:"views/billing.html"}).when("/speeddial",{controller:"speeddialController",templateUrl:"views/speeddial.html"}).when("/payments",{controller:"paymentController",templateUrl:"views/payment.html"}).otherwise({redirectTo:"/"})}]),i.service("sessionService",function(){var e={};return{resetSession:function(){e={}},getSession:function(){return e},setSession:function(o){e=o}}}),i.run(["$rootScope","$timeout","$route","$window","$location","sessionService",function(e,o,n,r,i,a){e.stateIsLoading=!1,e.$on("$routeChangeStart",function(o,n,r){e.stateIsLoading=!0}),e.$on("$locationChangeStart",function(e,o,n){var r=i.path(),s=a.getSession();s.hasOwnProperty("authenticated")&&!1!==s.authenticated?i.path(r):(console.log("here"),i.path("/"))}),e.$on("$routeChangeSuccess",function(){o(function(){e.stateIsLoading=!1},2e3)}),e.$on("$routeChangeError",function(){console.log("Error")})}]),i.controller("homeController",["$scope","$location","sessionService",function(e,o,n){firebase.auth().onAuthStateChanged(function(r){if(console.log(r),r){var i=(r.displayName,r.email,r.emailVerified),a=r.photoURL,s=r.uid,t=r.phoneNumber,l=r.providerData;r.totp;console.log(t,s),r.getIdToken().then(function(u){console.log(r,u);var c=firebase.database().ref().child("totp");querybase.ref(c,["number","user_id"]).where({number:t,user_id:s}).on("value",function(r){console.log(r.val());var c=null,d=null,p=null;if(null!==r.val()&&void 0!==r.val()){var f=Object.values(r.val());c=f[0].passcode,d=f[0].name,p=f[0].email}console.log(c,d,p);var m={displayName:d,email:p,emailVerified:i,phoneNumber:t,photoURL:a,uid:s,accessToken:u,providerData:l,authenticated:!0,activePage:"dashboard",totp:c};n.setSession(m),o.path("/dashboard"),e.$apply()})})}else{var u={signInSuccessUrl:"/",signInOptions:[{provider:firebase.auth.PhoneAuthProvider.PROVIDER_ID,defaultCountry:"IN"}]},c=new firebaseui.auth.AuthUI(firebase.auth());console.log("Not logged in"),c.start("#firebaseui-auth-container",u)}},function(e){console.log(e)})}]),i.controller("navController",["$scope","$location","sessionService",function(e,o,n){var r=n.getSession();e.session=r,e.goto=function(e,i){r.activePage=i,n.setSession(r),o.path(e)},e.logout=function(){firebase.auth().signOut().then(function(){console.log("Signed Out"),n.resetSession(),o.path("/")},function(e){console.error("Sign Out Error",e),n.resetSession(),o.path("/")})}}]),i.directive("strongSecret",function(){return{require:"ngModel",link:function(e,o,n,r){function i(e){return console.log(e),/^\d+$/.test(e)?(console.log("Here1"),r.$setValidity("numberValidator",!0)):(console.log("Here2"),r.$setValidity("numberValidator",!1)),4===e.length?(console.log("Here3"),r.$setValidity("fourCharactersValidator",!0)):(console.log("Here4"),r.$setValidity("fourCharactersValidator",!1)),e}r.$parsers.push(i)}}}),i.controller("speeddialController",["$scope","$location","sessionService",function(e,o,n){console.log("speedDial called!"),e.session=n.getSession(),e.dial={1:{name:"one",speed_number_prefix:"speed_number_one"},2:{name:"two",speed_number_prefix:"speed_number_two"},3:{name:"three",speed_number_prefix:"speed_number_three"},4:{name:"four",speed_number_prefix:"speed_number_four"},5:{name:"five",speed_number_prefix:"speed_number_five"},6:{name:"six",speed_number_prefix:"speed_number_six"},7:{name:"seven",speed_number_prefix:"speed_number_seven"},8:{name:"eight",speed_number_prefix:"speed_number_eight"},9:{name:"nine",speed_number_prefix:"speed_number_nine"}};var r=n.getSession();Object.keys(e.dial).forEach(function(o){var n=firebase.database().ref().child("speed_dials"),i=querybase.ref(n,["key","user_number","key_choice"]),a=i.where({user_number:r.phoneNumber,key:r.uid,key_choice:o});console.log(o),a.on("value",function(n){var r=n.val();if(null!==r){var i=Object.keys(r)[0],a=r[i].name,s=r[i].number;console.log("FOUND! ",o,a,s),""!==a&&""!==s&&(console.log("#"+e.dial[o].name,"#"+e.dial[o].speed_number_prefix),jQuery("#"+e.dial[o].name).val(a),jQuery("#"+e.dial[o].speed_number_prefix).val(s),jQuery("#"+e.dial[o].name).prop("disabled",!0),jQuery("#"+e.dial[o].speed_number_prefix).prop("disabled",!0))}})}),e.deleteContact=function(o){console.log(o);var r=n.getSession(),i=firebase.database().ref().child("speed_dials");querybase.ref(i,["key","user_number","key_choice"]).where({user_number:r.phoneNumber,key:r.uid,key_choice:o}).on("value",function(n){var r=n.val();if(null!==r){var i=Object.keys(r)[0];console.log("Here2",e.dial[o].name),jQuery("#"+e.dial[o].name).val(),jQuery("#"+e.dial[o].speed_number_prefix).val(),firebase.database().ref().child("speed_dials/"+i).remove().then(function(n){console.log(n),jQuery("#"+e.dial[o].name).val(""),jQuery("#"+e.dial[o].speed_number_prefix).val(""),jQuery("#"+e.dial[o].name).prop("disabled",!1),jQuery("#"+e.dial[o].speed_number_prefix).prop("disabled",!1)})}})},e.updateSpeedDial=function(){var o=n.getSession();console.log(o);for(var r in e.dial)!function(){var n=firebase.database().ref().child("speed_dials"),i=querybase.ref(n,["key","user_number","key_choice"]);i.where({user_number:o.phoneNumber,key:o.uid,key_choice:r}).on("value",function(n){console.log("Here2",e.dial[r].name);var a=jQuery("#"+e.dial[r].name).val(),s=jQuery("#"+e.dial[r].speed_number_prefix).val();s=s.replace(/^(\+91)/,""),console.log("lol",s,a),null===n.val()&&""!==s&&""!==a&&(i.push({user_number:o.phoneNumber,key:o.uid,key_choice:r,number:s,name:a}),jQuery("#"+e.dial[r].name).prop("disabled",!0),jQuery("#"+e.dial[r].speed_number_prefix).prop("disabled",!0))})}()}}]),i.controller("dashboardController",["$scope","$location","sessionService",function(e,o,n){e.session=n.getSession(),e.name=e.session.displayName,e.email=e.session.email,e.strongSecret=e.session.totp,e.updateProfile=function(){var o=firebase.database().ref().child("totp"),r=querybase.ref(o,["number","user_id"]),i=n.getSession();r.where({number:i.phoneNumber,user_id:i.uid}).on("value",function(o){if(null===o.val())r.push({number:i.phoneNumber,user_id:i.uid,passcode:e.strongSecret,name:e.name,email:e.email});else{var n=o.val(),a=Object.keys(n)[0];firebase.database().ref().child("totp/"+a).update({passcode:e.strongSecret,name:e.name,email:e.email}).then(function(e){console.log(e)})}})}}]),i.controller("paymentController",["$scope","$location","sessionService",function(e,o,n){e.session=n.getSession()}]),i.controller("billingController",["$scope","$location","sessionService",function(e,o,n){e.session=n.getSession()}])},{}]},{},[1]);